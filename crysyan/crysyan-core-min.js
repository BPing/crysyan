!function(){"use strict";function e(t){if(null===t||"object"!=typeof t)return t;var n;t instanceof Array?n=[]:t instanceof Object&&(n={});for(var a in t)n[a]=e(t[a]);return n}var t={addEvent:function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n,this},removeEvent:function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null,this},isIE:function(){return"Microsoft Internet Explorer"===navigator.appName},isNumber:function(e){return"NaN"!==parseFloat(e).toString()},findElement:function(e){return document.getElementById(e)}};t.clone=e,window.CrysyanUtil=t}(),function(){window.CrysyanWidgetConfig={widgets:{CursorWidget:{exportVar:"CrysyanCursorWidget",jsFile:"cursor.js",icon:"cursor.png",name:"cursor"},PencilWidget:{exportVar:"CrysyanPencilWidget",jsFile:"pencil.js",icon:"pencil.png",name:"pencil"},ShapeWidget:{exportVar:"CrysyanShapeWidget",jsFile:"shape.js",icon:"shape.png",name:"shape"},EraserWidget:{exportVar:"CrysyanEraserWidget",jsFile:"eraser.js",icon:"eraser.png",name:"eraser"},ImageWidget:{exportVar:"CrysyanImageWidget",jsFile:"image.js",icon:"image.png",name:"image"},TextWidget:{exportVar:"CrysyanTextWidget",jsFile:"text.js",icon:"text.png",name:"text"},UndoWidget:{exportVar:"CrysyanUndoWidget",jsFile:"undo.js",icon:"undo.png",name:"undo"},IndoGoWidget:{exportVar:"CrysyanIndoGoWidget",jsFile:"into-go.js",icon:"into-go.png",name:"into-go"},ClearWidget:{exportVar:"CrysyanClearWidget",jsFile:"clear.js",icon:"clear.png",name:"clear"}}},window.CrysyanDefaultConfig={projectPath:"",isRecord:!1,cssFile:"",submit:{Id:"crysyan-submit",callback:function(e,t){}},canvas:{canvasId:"crysyan-canvas",width:900,height:400,historyListLen:50,bgColor:"#ffffff"},toolbar:{Id:"crysyan-toolbar",length:900,widgetLength:50,widgets:["CursorWidget","PencilWidget","ShapeWidget","EraserWidget","ImageWidget","TextWidget","UndoWidget","IndoGoWidget","ClearWidget"]}}}(),function(e){"use strict";var t={id:"widget-id",icon:"widget-icon",name:"widget-name",CrysyanWidgetType:"CrysyanWidget",crysyanCanvas:null,prePoint:{e:null,loc:null},isDown:!1,mouseDown:function(e,t){},mouseUp:function(e,t){},mouseMove:function(e,t){},iconClick:function(e,t){},iconLeave:function(e,t){},clone:function(){return e.clone(this)}};window.CrysyanWidget=t}(CrysyanUtil),function(e){"use strict";function t(e){if("object"!=typeof e&&(e={}),e=$.extend(t.defaultOptions,e),this.playCanvas=document.getElementById(e.canvasId),null===this.playCanvas)throw"can't get the Element by id:"+e.canvasId;this.playContext=this.playCanvas.getContext("2d"),0!==e.width&&(this.playCanvas.width=e.width),0!==e.height&&(this.playCanvas.height=e.height),this.drawingSurfaceImageData=null,this.backgroudImage={image:null,width:0,height:0},this.backgroudColor=e.bgColor||"#ffffff",this.revokeImgDatas=[],this.forwardRevokeImgDatas=[],this.historyListLen=e.historyListLen,this.clearCanvas()}t.prototype={saveDrawingSurface:function(){return this.drawingSurfaceImageData=this.playContext.getImageData(0,0,this.playCanvas.width,this.playCanvas.height),this.drawingSurfaceImageData},restoreDrawingSurface:function(e){this.playContext.putImageData(e||this.drawingSurfaceImageData,0,0)},saveRevokeImgDatas:function(){var e=this.playContext.getImageData(0,0,this.playCanvas.width,this.playCanvas.height);this.revokeImgDatas.length>=this.historyListLen?(this.revokeImgDatas.shift(),this.revokeImgDatas.push(e)):this.revokeImgDatas.push(e),this.forwardRevokeImgDatas=[]},saveForwardRevokeFirstFrame:function(){this.forwardRevokeImgDatas[0]=this.playContext.getImageData(0,0,this.playCanvas.width,this.playCanvas.height)},revoke:function(){if(this.revokeImgDatas.length<=0)return 0;var e=this.revokeImgDatas.pop();this.forwardRevokeImgDatas.push(e),this.playContext.putImageData(e,0,0)},forwardRevoke:function(){if(this.forwardRevokeImgDatas.length<=0)return 0;var e=this.forwardRevokeImgDatas.pop();this.revokeImgDatas.push(e),this.playContext.putImageData(e,0,0)},clearCanvas:function(){this.playContext.save(),this.playContext.fillStyle=this.backgroudColor,this.playContext.fillRect(0,0,this.playCanvas.width,this.playCanvas.height),this.clearCanvasWithOnlyBackGroundImage(),this.playContext.restore()},clearCanvasWithOnlyBackGroundImage:function(){if(null!==this.backgroudImage.image){var e=this.backgroudImage.image;this.drawImage(e,(this.playCanvas.width-e.width)/2,(this.playCanvas.height-e.height)/2,e.width,e.height)}},windowToCanvas:function(e,t){var n=this.playCanvas.getBoundingClientRect();return{x:e-n.left,y:t-n.top}},canvasToWindow:function(e,t){var n=this.playCanvas.getBoundingClientRect();return{x:e+n.left,y:t+n.top}},canvasPosition:function(){var e=this.playCanvas.getBoundingClientRect(),t=document.documentElement.clientTop,n=document.documentElement.clientLeft;return{top:e.top-t,bottom:e.bottom-t,left:e.left-n,right:e.right-n}},drawBackgroundWithImage:function(e,t){void 0===t&&(t=1);var n=this,a=new Image;if(a.crossOrigin="Anonymous",a.onload=function(){if(n.backgroudImage.image=a,n.backgroudImage.width=n.playCanvas.width,n.backgroudImage.height=n.playCanvas.height,1===t){var e=0===a.width||0===n.playCanvas.width?0:a.width/n.playCanvas.width,i=0===a.height||0===n.playCanvas.height?0:a.height/n.playCanvas.height;a.width>=n.playCanvas.width&&e>i?(a.width=n.backgroudImage.width,a.height=n.backgroudImage.height=n.playCanvas.height*(1/e).toFixed(2)):a.height>=n.playCanvas.height&&i>e&&(a.width=n.backgroudImage.width=n.playCanvas.width*(1/i).toFixed(2),a.height=n.backgroudImage.height)}else a.width>=n.backgroudImage.width&&(a.width=n.backgroudImage.width),a.height>=n.backgroudImage.height&&(a.height=n.backgroudImage.height);n.clearCanvas()},e instanceof Image||parent&&parent.window&&e instanceof parent.window.Image||void 0!==e.src)a.src=e.src;else{if(e instanceof File||e instanceof Blob||parent&&parent.window&&(e instanceof parent.window.File||e instanceof parent.window.Blob)){var i=new FileReader;return i.onload=function(e){a.src=e.target.result},void i.readAsDataURL(file)}"string"!=typeof e?console.error("drawBackGroupWithImage:Obj is invalid parameter"):a.src=e}},drawImageFile:function(e){var t=this,n=new FileReader;n.onload=function(e){t.drawDataUrl(e.target.result)},n.readAsDataURL(e)},drawDataUrl:function(e){var t=this.playContext,n=new Image;n.crossOrigin="Anonymous",n.onload=function(){arguments[0]=n,t.drawImage.apply(t,arguments)},n.src=e},drawImage:function(){var e=this.playContext;e.drawImage.apply(e,arguments)},toDataURL:function(e,t){return this.playCanvas.toDataURL(e,t)},toImageEle:function(e,t,n){var a=new Image;return a.onload=function(){n()},a.src=this.toDataURL(e,t),a},toBlob:function(e,t){for(var n=this.toDataURL(e,t).split(","),a=n[0].match(/:(.*?);/)[1],i=atob(n[1]),o=i.length,s=new Uint8Array(o);o--;)s[o]=i.charCodeAt(o);return new Blob([s],{type:a})},saveAsLocalImagePng:function(){var e=this.toDataURL("image/png").replace("image/png","image/octet-stream;Content-Disposition:attachment;filename=foo.png");window.location.href=e},getCanvasRecorder:function(e){return RecordRTC?(e=e||{},e.type="canvas",new RecordRTC(this.playCanvas,e)):(console.error("can't record canvas"),null)},addEvent:function(t,n){e.addEvent(this.playCanvas,t,n)},mousedown:function(e){if("function"==typeof e){var t=this,n=function(n){void 0!==n.type&&(n.preventDefault(),n.stopPropagation(),n.type,"touchstart"===n.type&&(n=n.clientX?n:n.touches.length?n.touches[0]:{clientX:0,clientY:0}),t.saveRevokeImgDatas(),t.saveDrawingSurface(),e(n,t.windowToCanvas(n.clientX,n.clientY)))};t.addEvent("mousedown",n),"createTouch"in document&&t.addEvent("touchstart",n)}},mousemove:function(e){if("function"==typeof e){var t=this,n=function(n){void 0!==n.type&&(n.preventDefault(),n.stopPropagation(),n.type,"touchmove"===n.type&&(n=n.clientX?n:n.touches.length?n.touches[0]:{clientX:0,clientY:0}),e(n,t.windowToCanvas(n.clientX,n.clientY)))};t.addEvent("mousemove",n),"createTouch"in document&&t.addEvent("touchmove",n)}},mouseup:function(e){if("function"==typeof e){var t=this,n=function(n){void 0!==n.type&&(n.preventDefault(),n.stopPropagation(),n.type,"touchend"===n.type&&null===(n=n.clientX?n:n.touches.length?n.touches[0]:n.changedTouches.length?n.changedTouches[0]:null)||(e(n,t.windowToCanvas(n.clientX,n.clientY)),t.saveForwardRevokeFirstFrame()))};t.addEvent("mouseup",n),"createTouch"in document&&t.addEvent("touchend",n)}}},t.prototype.constructor=t,t.defaultOptions={width:0,height:0,canvasId:"crysyan-canvas",historyListLen:50,bgColor:"#ffffff"},window.CrysyanCanvas=t}(CrysyanUtil),function(e,t,n){"use strict";function a(t){if(t=t||{},this.ops={},this.ops.common=$.extend(e.submit,t.common||{}),this.ops.submit=$.extend(e.submit,t.submit||{}),this.ops.canvas=$.extend(e.canvas,t.canvas||{}),this.ops.toolbar=$.extend(e.toolbar,t.toolbar||{}),this.ops=$.extend(t,this.ops),this.crysyanCanvas=new CrysyanCanvas(this.ops.canvas),this.toolbarElement=document.getElementById(this.ops.toolbar.Id),this.submitElement=document.getElementById(this.ops.submit.Id),null===this.toolbarElement)throw"can't get the Element by id:"+this.ops.toolbar.Id;this.widgetSelected="",this.widgetEventMap={}}var i={},o=function(e){for(var n=e.ops.toolbar.widgets,a=t.widgets,o='<ul id="widgets-list" class="ul-widget-list ">',s=0;s<n.length;s++){var r=n[s];if(!i.hasOwnProperty(r)&&a.hasOwnProperty(r)&&window.hasOwnProperty(a[r].exportVar)){var c=window[a[r].exportVar];c.icon=a[r].icon,c.crysyanCanvas=e.crysyanCanvas,c.hasOwnProperty("CrysyanWidgetType")&&(e.widgetEventMap[c.CrysyanWidgetType]=c,o=o+' <li><img draggable="false" width="'+e.ops.toolbar.widgetLength+'px" height="'+e.ops.toolbar.widgetLength+'px"  id="'+c.CrysyanWidgetType+' " class="crysyan-widget-class" src=" '+c.icon+'  "></li>'),i[r]=1}else console.error("widget: '"+r+"'does not exist")}o+="</ul>",e.toolbarElement.innerHTML=o,e.widgetSelected="CrysyanCursorWidget",$(".crysyan-widget-class",document).each(function(){var t=$(this),n=this,a=t.attr("id").replace(/\s+/g,""),i=function(i){"CrysyanUndoWidget"!==a&&"CrysyanIndoGoWidget"!==a&&"CrysyanClearWidget"!==a&&($(".widget-selected-shape",document).each(function(){$(this).removeClass("widget-selected-shape")}),t.addClass("widget-selected-shape"),e.widgetSelected!==a&&e.widgetEventMap[e.widgetSelected]&&e.widgetEventMap[e.widgetSelected].iconLeave(n,i),e.widgetSelected=a),e.widgetEventMap.hasOwnProperty(a)&&e.widgetEventMap[a].iconClick(n,i)};t.click(i)})},s=function(e){e.crysyanCanvas.mousedown(function(t,n){if(e.widgetEventMap.hasOwnProperty(e.widgetSelected)){var a=e.widgetEventMap[e.widgetSelected];a.isDown=!0,a.prePoint.e=t,a.prePoint.loc=n,a.mouseDown(t,n)}}),e.crysyanCanvas.mousemove(function(t,n){e.widgetEventMap.hasOwnProperty(e.widgetSelected)&&e.widgetEventMap[e.widgetSelected].mouseMove(t,n)}),e.crysyanCanvas.mouseup(function(t,n){if(e.widgetEventMap.hasOwnProperty(e.widgetSelected)){var a=e.widgetEventMap[e.widgetSelected];a.isDown=!1,a.mouseUp(t,n)}})};a.prototype={init:function(){var e=this;return o(e),s(e),null!==e.submitElement&&n.addEvent(e.submitElement,"click",function(t){e.ops.submit.callback(e.crysyanCanvas,t)}),this}},a.prototype.constructor=a,window.CrysyanView=a}(CrysyanDefaultConfig,CrysyanWidgetConfig,CrysyanUtil),function(e){"use strict";var t=e.clone();t.mouseDown=function(e,t){},t.mouseMove=function(e,t){},t.mouseUp=function(e,t){},t.CrysyanWidgetType="CrysyanCursorWidget",window.CrysyanCursorWidget=t}(CrysyanWidget),function(e,t){"use strict";function n(e){return document.getElementById(e)}function a(e,t,n,a,i){e.moveTo(t,n),e.lineTo(a,i),e.stroke()}function i(e,t,n,a,i,o){o=void 0===o?2:o;for(var s=a-t,r=i-n,c=Math.floor(Math.sqrt(s*s+r*r)/o),l=0;l<c;++l)e[l%2==0?"moveTo":"lineTo"](t+s/c*l,n+r/c*l);e.stroke()}var o=e.clone(),s=o;s.menu=null,s.iconClick=function(e,t){var n=e.getBoundingClientRect();s.menu||(s.menu=new r(s)),s.menu.display(n)},s.iconLeave=function(e,t){s.menu.hide()},s.config={lineJoin:"round",lineCap:"round",lineWidth:1,strokeStyle:"#000000",type:0},s.mouseDown=function(e,t){var n=this,a=n.crysyanCanvas.playContext;n.menu.hide(),a.save(),n.setConfig()},s.mouseMove=function(e,t){var n=this;if(n.isDown){var o=n.crysyanCanvas.playContext;switch(n.config.type){case 0:case"0":o.beginPath(),a(o,n.prePoint.loc.x,n.prePoint.loc.y,t.x,t.y),n.prePoint.e=e,n.prePoint.loc=t;break;case 1:case"1":n.crysyanCanvas.restoreDrawingSurface(),o.beginPath(),a(o,n.prePoint.loc.x,n.prePoint.loc.y,t.x,t.y),o.closePath();break;case 2:case"2":n.crysyanCanvas.restoreDrawingSurface(),o.beginPath(),i(o,n.prePoint.loc.x,n.prePoint.loc.y,t.x,t.y,2*n.config.lineWidth),o.closePath()}}},s.mouseUp=function(e,t){s.crysyanCanvas.playContext.restore()},s.setConfig=function(){var e=this,t=e.crysyanCanvas.playContext;t.lineCap=e.config.lineCap,t.lineWidth=e.config.lineWidth,t.strokeStyle=e.config.strokeStyle};var r=function(e){this.pencil=e,this.menuEle=null};r.prototype={init:function(){this.menuEle=document.createElement("section"),this.menuEle.setAttribute("id","crysyan-pencil-menu"),this.menuEle.setAttribute("class","crysyan-second-toolbar"),this.menuEle.style.display="none";var e=this,a=this.pencil.config,i="<ul>";i=i.concat("<li type='margin-bottom: 10px;'><label for='crysyan-pencil-type'>line type:</label><select id='crysyan-pencil-type'>");var o=["default-line","full-line","dash-line"];for(var s in o)i=i.concat('<option value="',s,'">',o[s],"</option>");i=(i=i.concat("</select></li>")).concat("<li type='margin-bottom: 10px;'><label for='crysyan-pencil-line-width'>line width:</label><select id='crysyan-pencil-line-width'>");var r=["1","2","3","4","5","6","7","8","9","10"];for(var s in r)i=i.concat('<option value="',r[s],'">',r[s],"px</option>");i=(i=(i=(i=i.concat("</select></li>")).concat("<li type='margin-bottom: 10px;'><label for='crysyan-pencil-color'>line color:</label><input id='crysyan-pencil-color' type='color' value='",a.strokeStyle,"'></li>")).concat("<li id='crysyan-pencil-done' class='crysyan-btn-done'>Done</li>")).concat("</ul>"),this.menuEle.innerHTML=i,(document.getElementsByTagName("body").item(0)||document.documentElement).appendChild(this.menuEle);var c=n("crysyan-pencil-type"),l=n("crysyan-pencil-line-width"),d=n("crysyan-pencil-color");t.addEvent(n("crysyan-pencil-done"),"click",function(){a.type=c.value,a.lineWidth=l.value,a.strokeStyle=d.value,e.hide()})},display:function(e){this.menuEle||this.init();var t=this.menuEle.style;this.top=e.top-80,this.left=e.left-10,t.display="inline",t.top=this.top+"px",t.left=this.left+"px"},hide:function(){this.menuEle.style.display="none"}},o.CrysyanWidgetType="CrysyanPencilWidget",window.CrysyanPencilWidget=o}(CrysyanWidget,CrysyanUtil),function(e,t){"use strict";function n(e){return document.getElementById(e)}var a=e.clone(),i=a;i.eraserWidth=15,i.shapeType=0,i.menu=null,i.iconClick=function(e,t){var n=e.getBoundingClientRect();i.menu||(i.menu=new o(i)),i.menu.display(n)},i.iconLeave=function(e,t){i.menu.hide()},i.mouseDown=function(e,t){i.menu.hide();var n=i.crysyanCanvas.playContext;switch(i.shapeType){case 0:case"0":case 1:case"1":break;case 2:case"2":n.save(),n.beginPath(),n.moveTo(t.x,t.y)}},i.mouseMove=function(e,t){if(i.isDown){var n=i.crysyanCanvas.playContext;switch(i.shapeType){case 0:case"0":case 1:case"1":i.eraseLast(n,i.shapeType),i.drawEraser(t,n,i.shapeType);break;case 2:case"2":n.lineTo(t.x,t.y),n.stroke()}i.prePoint.e=e,i.prePoint.loc=t}},i.mouseUp=function(){var e=i.crysyanCanvas.playContext;switch(i.shapeType){case 0:case"0":case 1:case"1":i.eraseLast(e,i.shapeType);break;case 2:case"2":e.closePath(),e.clip(),i.crysyanCanvas.restoreDrawingSurface(),i.crysyanCanvas.clearCanvas(),e.restore()}},i.setDrawPathForEraser=function(e,t,n){t.beginPath(),"0"===n||0===n?t.arc(e.x,e.y,i.eraserWidth/2,0,2*Math.PI,!1):"1"!==n&&1!==n||t.rect(e.x-i.eraserWidth/2,e.y-i.eraserWidth/2,i.eraserWidth,i.eraserWidth),t.clip()},i.setEraserAttributes=function(e){e.lineWidth=1,e.shadowColor="blue",e.shadowOffsetX=-5,e.shadowOffsetY=-5,e.shadowBlur=20,e.strokeStyle="rgb(0,0,255)"},i.eraseLast=function(e,t){"0"===t||0===t?(e.save(),e.beginPath(),e.arc(i.prePoint.loc.x,i.prePoint.loc.y,i.eraserWidth/2+1,0,2*Math.PI,!1),e.fillStyle=i.crysyanCanvas.backgroudColor,e.fill(),e.restore(),e.save(),e.beginPath(),e.arc(i.prePoint.loc.x,i.prePoint.loc.y,i.eraserWidth/2+1+1,0,2*Math.PI,!1)):"1"!==t&&1!==t||(e.save(),e.beginPath(),e.rect(i.prePoint.loc.x-i.eraserWidth/2-1,i.prePoint.loc.y-i.eraserWidth/2-1,i.eraserWidth/1+1,i.eraserWidth/1+1+1),e.fillStyle=i.crysyanCanvas.backgroudColor,e.fill(),e.restore(),e.save(),e.beginPath(),e.rect(i.prePoint.loc.x-i.eraserWidth/2-1-1,i.prePoint.loc.y-i.eraserWidth/2-1-1,i.eraserWidth/1+1+1,i.eraserWidth/1+1+3)),e.clip(),i.crysyanCanvas.clearCanvasWithOnlyBackGroundImage(),e.restore()},i.drawEraser=function(e,t,n){t.save(),i.setEraserAttributes(t,n),i.setDrawPathForEraser(e,t,n),t.stroke(),t.restore()};var o=function(e){this.eraser=e,this.menuEle=null};o.prototype={init:function(){this.menuEle=document.createElement("section"),this.menuEle.setAttribute("id","crysyan-pencil-menu"),this.menuEle.setAttribute("class","crysyan-second-toolbar"),this.menuEle.style.display="none";var e="<ul>";e=e.concat("<li type='margin-bottom: 10px;'><label for='crysyan-eraser-shape'>shape:</label><select id='crysyan-eraser-shape'>");var a=["Circular","Square","Path"];for(var i in a)e=e.concat('<option value="',i,'">',a[i],"</option>");e=(e=e.concat("</select></li>")).concat("<li type='margin-bottom: 10px;'><label for='crysyan-eraser-diameter'>diameter:</label><select id='crysyan-eraser-diameter'>");var o=["15","25","35","45","55"];for(var i in o)e=e.concat('<option value="',o[i],'">',o[i],"px</option>");e=(e=(e=e.concat("</select></li>")).concat("<li id='crysyan-eraser-done' class='crysyan-btn-done'>Done</li>")).concat("</ul>"),this.menuEle.innerHTML=e,(document.getElementsByTagName("body").item(0)||document.documentElement).appendChild(this.menuEle);var s=this,r=this.eraser,c=n("crysyan-eraser-shape"),l=n("crysyan-eraser-diameter");t.addEvent(n("crysyan-eraser-done"),"click",function(){r.eraserWidth=l.value,r.shapeType=c.value,s.hide()})},display:function(e){this.menuEle||this.init();var t=this.menuEle.style;this.top=e.top-80,this.left=e.left-10,t.display="inline",t.top=this.top+"px",t.left=this.left+"px"},hide:function(){this.menuEle.style.display="none"}},a.CrysyanWidgetType="CrysyanEraserWidget",window.CrysyanEraserWidget=a}(CrysyanWidget,CrysyanUtil),function(e,t){"use strict";var n=e.clone(),a=n;a.mouseDown=function(e,t){a.crysyanCanvas.saveDrawingSurface()},a.mouseMove=function(e,t){a.isDown&&(a.crysyanCanvas.restoreDrawingSurface(),a.drawImage(a.crysyanCanvas.playContext,t))},a.mouseUp=function(e,t){a.isDown&&(a.crysyanCanvas.restoreDrawingSurface(),a.drawImage(a.crysyanCanvas.playContext,t))},a.iconClick=function(e,t){a.selectFile(function(e){e&&a.fileReader(e)},!1)},a.drawImage=function(e,t){var n=a.prePoint.loc;a.imageHandler.image&&t.x-n.x!=0&&e.drawImage(a.imageHandler.image,n.x,n.y,t.x-n.x,t.y-n.y)},a.imageHandler={image:null,isLoad:!1,imgSrc:""},a.selectFile=function(e,t){var n=document.createElement("input");n.type="file",t&&(n.multiple=!0),n.onchange=function(){if(t)return n.files.length?void e(n.files):void console.error("No file selected.");n.files[0]?(e(n.files[0]),n.parentNode.removeChild(n)):console.error("No file selected.")},n.style.display="none",(document.body||document.documentElement).appendChild(n),a.fireClickEvent(n)},a.fireClickEvent=function(e){if(t.isIE())e.click();else{var n=document.createEvent("MouseEvent");n.initEvent("click",!0,!0),e.dispatchEvent(n)}},a.fileReader=function(e){var t=new FileReader;t.onload=function(e){a.imageHandler.image=new Image,a.imageHandler.isLoad=!1,a.imageHandler.image.onload=function(){a.imageHandler.isLoad=!0},a.imageHandler.image.src=e.target.result},t.readAsDataURL(e)},n.CrysyanWidgetType="CrysyanImageWidget",window.CrysyanImageWidget=n}(CrysyanWidget,CrysyanUtil),function(e,t){"use strict";function n(e){return document.getElementById(e)}var a=e.clone(),i=a;i.shapeType=0,i.depictType=1,i.lineWidth=1,i.strokeStyle="#000000",i.fillStyle="#000000",i.depictType=1,i.menu=!1,i.setConfig=function(){var e=i.crysyanCanvas.playContext;e.lineWidth=i.lineWidth,e.strokeStyle=i.strokeStyle,e.fillStyle=i.fillStyle},i.iconClick=function(e,t){var n=e.getBoundingClientRect();i.menu||(i.menu=new o(i)),i.menu.display(n)},i.iconLeave=function(e,t){i.menu.hide()},i.mouseDown=function(e,t){i.menu.hide()},i.mouseMove=function(e,t){i.isDown&&i.drawShape(e,t)},i.mouseUp=function(e,t){i.drawShape(e,t)},i.drawShape=function(e,t){var n=i.crysyanCanvas.playContext;i.crysyanCanvas.restoreDrawingSurface();var a=i.prePoint.loc;switch(n.save(),i.setConfig(),n.beginPath(),i.shapeType){case 0:case"0":o=t.x-a.x;n.moveTo(a.x,a.y),n.lineTo(t.x,t.y),n.lineTo(t.x-2*o,t.y);break;case 1:case"1":n.rect(a.x,a.y,t.x-a.x,t.y-a.y);break;case 2:case"2":var o=t.x-a.x,s=t.y-a.y;n.arc(a.x,a.y,Math.sqrt(Math.pow(o,2)+Math.pow(s,2)),0,2*Math.PI,!1)}n.closePath(),0!=(1&i.depictType)&&n.stroke(),0!=(2&i.depictType)&&n.fill(),n.restore()};var o=function(e){this.shape=e,this.menuEle=null};o.prototype={init:function(){this.menuEle=document.createElement("section"),this.menuEle.setAttribute("id","crysyan-pencil-menu"),this.menuEle.setAttribute("class","crysyan-second-toolbar"),this.menuEle.style.display="none";var e="<ul>";e=e.concat("<li type='margin-bottom: 10px;'><label for='crysyan-shape-type'>shape:</label><select id='crysyan-shape-type'>");var a=["Triangle","Rect","Circular"];for(var i in a)e=e.concat('<option value="',i,'">',a[i],"</option>");e=(e=e.concat("</select></li>")).concat("<li type='margin-bottom: 10px;'><label for='crysyan-depict-type'>draw:</label><select id='crysyan-depict-type'>");var o={1:"stroke",2:"fill",3:"stroke&fill"};for(var i in o)e=e.concat('<option value="',i,'">',o[i],"</option>");e=(e=(e=(e=(e=e.concat("</select></li>")).concat("<li type='margin-bottom: 10px;'><label for='crysyan-shape-stroke-color'>stroke color:</label><input id='crysyan-shape-stroke-color' type='color' value='",this.shape.strokeStyle,"'></li>")).concat("<li type='margin-bottom: 10px;'><label for='crysyan-shape-fill-color'>fill color:</label><input id='crysyan-shape-fill-color' type='color' value='",this.shape.fillStyle,"'></li>")).concat("<li id='crysyan-shape-done' class='crysyan-btn-done'>Done</li>")).concat("</ul>"),this.menuEle.innerHTML=e,(document.getElementsByTagName("body").item(0)||document.documentElement).appendChild(this.menuEle);var s=this,r=this.shape,c=n("crysyan-shape-type"),l=n("crysyan-depict-type"),d=n("crysyan-shape-fill-color"),y=n("crysyan-shape-stroke-color");t.addEvent(n("crysyan-shape-done"),"click",function(){r.shapeType=c.value,r.fillStyle=d.value,r.strokeStyle=y.value,r.depictType=parseInt(l.value),s.hide()})},display:function(e){this.menuEle||this.init();var t=this.menuEle.style;this.top=e.top-80,this.left=e.left-10,t.display="inline",t.top=this.top+"px",t.left=this.left+"px"},hide:function(){this.menuEle.style.display="none"}},i.CrysyanWidgetType="CrysyanShapeWidget",window.CrysyanShapeWidget=a}(CrysyanWidget,CrysyanUtil),function(e){"use strict";var t=e.clone();t.iconClick=function(e,n){t.crysyanCanvas.revoke()},t.CrysyanWidgetType="CrysyanUndoWidget",window.CrysyanUndoWidget=t}(CrysyanWidget),function(e){"use strict";var t=e.clone();t.iconClick=function(e,t){CrysyanUndoWidget.crysyanCanvas.forwardRevoke()},t.CrysyanWidgetType="CrysyanIndoGoWidget",window.CrysyanIndoGoWidget=t}(CrysyanWidget),function(e){"use strict";var t=e.clone();t.iconClick=function(e,t){this.crysyanCanvas.clearCanvas()},t.CrysyanWidgetType="CrysyanClearWidget",window.CrysyanClearWidget=t}(CrysyanWidget);var CrysyanFlag=!1;!function(e){"use strict";function t(e,t){var n=document.getElementsByTagName("head").item(0)||document.documentElement;if("string"==typeof e&&(e=[e]),"object"==typeof e){var a=function(i){if(i>=e.length)"function"==typeof t&&t();else{var o=document.createElement("script");o.src=e[i],o.type="text/javascript",o.onload=o.onreadystatechange=function(){this.onload=this.onreadystatechange=null,this.parentNode.removeChild(this),i<e.length&&a(i+1)},n.appendChild(o)}};a(0)}}function n(e){if("string"==typeof e){var t=document.getElementsByTagName("head").item(0)||document.documentElement,n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",e),t.appendChild(n)}}if(void 0===e&&(e=!0),!window.$){var a=window.parent.$||window.parent.jQuery||window.jQuery;if(!a)throw new Error("Crysyan requires 'jQuery'");window.$=a}var i={},o={};!function(){var e=decodeURI(location.search);if(-1!==e.indexOf("?"))for(var t=e.substr(1).split("&"),n=0;n<t.length;n++)o[t[n].split("=")[0]]=t[n].split("=")[1]}();var s=function(n){var a=[],i=CrysyanWidgetConfig.widgets;for(var o in i)i[o].hasOwnProperty("jsFile")&&"string"==typeof i[o].jsFile&&""!==i[o].jsFile&&a.push("../js/widget/"+i[o].jsFile),i[o].hasOwnProperty("icon")&&(i[o].icon="img/"+i[o].icon);e?t(a,n):n()},r=function(){s(function(){var e=JSON.parse(o.config),a=function(){var t=new CrysyanView(e).init();i.default=t};e.cssFile&&""!==e.cssFile&&n(e.cssFile),e.isRecord&&!0===e.isRecord?t("RecordRTC.js",function(){a()}):a()})};e?t(["../js/util.js","../js/config.js","../js/widget.js","../js/widget.js","../js/canvas.js","../js/view.js"],r):r();var c={getView:function(e){return void 0!==e&&""!==e||(e="default"),i[e]}};window.Crysyan=c}(void 0===CrysyanFlag||CrysyanFlag);